# Lab 6/7

This is a search page where you can search for course equivalencies between Dalhousie University and other partner institutions.

## Setup

For the system to work you need a web server running and the code for the website needs to be in the root of the servers public facing directory, for example -

```
web.cs.dal.ca/yourcsid~ -
	transfer -
		Everything for the site
```



You also need a database environment running either MySQL or MariaDB. In this environment you will need a database containing a table which can be created using the following statement.

```sql
create table search_engine_db
(
	id int null,
	province_code text null,
	province_name text null,
	transfer_inst_code text null,
	transfer_inst_name text null,
	subject_code text null,
	subject_name text null,
	transfer_inst_course text null,
	transfer_credits text null,
	dal_course text null,
	dal_credits text null,
	last_assessed_year text null,
	last_assessed_semester text null
);
```

You then need to import the file *search_engine_db.csv* into the database, making sure to set any inconvertible values to null. The CSV can be generated by running *scrape.py* with the command `python3 scrape.py`. (It takes about an hour to run, even longer if not ran on a Dalhousie server).

Once the file has been imported, execute the following on your new database table to create an index of the table. 

```sql
create fulltext index search_index
	on search_engine_db (province_name, transfer_inst_name, subject_code, subject_name, transfer_inst_course, transfer_credits, dal_course, dal_credits, last_assessed_year, last_assessed_semester);
```

Finally you need to modify the top of the file *config/Database.php* to match your database connection details.

## Usage

To use the transfer page, simply load the page and enter different search terms. The most relevant results will then be displayed at the top of the course list. You can combine multiple terms in the search, such as 'Newcastle mathematics' to get all math courses from Newcastle. The fields that can be included in the search are ,host university, course name/code at host, course name/code at Dalhousie, credit hours at both the host and Dalhousie, approval date (year and semester), province name, subject code at Dalhousie and subject name at Dalhousie. The more of a field name you enter, the more accurate the results will be, for example the search 'Newcastle mathematics' will return more accurate result than just 'Newcastle'.

## API
### Creating a query

There is an API for the system which returns JSON formatted search results which can be used for different systems such as websites are apps. The API allows the results to be filtered based on a variety of fields. These are -

| Parameter Name         | Description                                                  | Examples                                                     |
| ---------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| search                 | A search term.                                               | Newcastle mathematics, Biology, csci 1105                    |
| id                     | An ID of an individual course equivalency.                   | 1, 2, 3                                                      |
| province_code          | The code of a province.                                      | NS, YT, WI                                                   |
| province_name          | The name of the province/state a transfer institution is in. | Nova Scotia, Alabama, Out of country                         |
| transfer_inst_code     | The code for a transfer institution.                         | XPL015, XEG003,  YTU002                                      |
| transfer_inst_name     | The name of a transfer institution.                          | Cascadia College, Acadia University,                         |
| subject_code           | The code for a subject at Dalhousie.                         | PHYC, ENGL, PHIL                                             |
| subject_name           | The name of a subject at Dalhousie.                          | English, Mathematics, History                                |
| transfer_inst_course   | The name of a course at a transfer institution.              | ENG 101 English Composition I, MATH 208 Linear Algebra, IT 261 Advanced IT Topics I |
| transfer_credits       | The number of credits a course is worth at a transfer institution. | 3, 6, 12                                                     |
| dal_course             | The name of a course at Dalhousie.                           | SOSA 1500 Globalizations, CSCI 2999 2000 level elective, ASSC 1999 1000 Level Elective |
| dal_credits            | The number of credits a course is worth at Dalhousie.        | 3, 6, 12                                                     |
| last_assessed_year     | The year the course equivalency was last assessed.           | 2016, 2017, 2018                                             |
| last_assessed_semester | The semester the course equivalency was last assessed.       | fall, summer, winter                                         |

There are also parameters to control what / how much data is returned -

| Parameter Name | Description                                      | Examples   |
| -------------- | ------------------------------------------------ | ---------- |
| start_index    | Where in the result set to start returning from. | 0, 10, 20  |
| count          | How many results to return at a time.            | 10, 20, 30 |



### Example Queries

```
/api/equivalencies/view.php?start_index=0&count=10
```

Get the first 10 courses using no search or filters.



```
/api/equivalencies/view.php?start_index=0&count=10&province_name=Nova Scotia
```

Get the first 10 courses where they're in Nova Scotia.



```
/api/equivalencies/view.php?start_index=0&count=10&search=Biology
```

Get the first 10 courses where they match the search term Biology,



```
/api/equivalencies/view.php
```

Get all courses. (**Not** recommended, can cause memory issues and can be slow)

